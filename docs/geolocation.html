<!DOCTYPE html>  <html> <head>   <title>geolocation.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="init.html">                 init.js               </a>                                           <a class="source" href="basemaps.html">                 basemaps.js               </a>                                           <a class="source" href="cache.html">                 cache.js               </a>                                           <a class="source" href="features.html">                 features.js               </a>                                           <a class="source" href="geolocation.html">                 geolocation.js               </a>                                           <a class="source" href="layers.html">                 layers.js               </a>                                           <a class="source" href="legend.html">                 legend.js               </a>                                           <a class="source" href="map.html">                 map.js               </a>                                           <a class="source" href="meta.html">                 meta.js               </a>                                           <a class="source" href="scalebar.html">                 scalebar.js               </a>                                           <a class="source" href="search.html">                 search.js               </a>                                           <a class="source" href="utilities.html">                 utilities.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               geolocation.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Enable the user to take advantage of the geolocation capabilities of their browser</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="nx">define</span><span class="p">(</span><span class="s1">&#39;SKGeolocation&#39;</span><span class="p">,</span> <span class="p">[</span> <span class="s1">&#39;dojo/_base/declare&#39;</span> <span class="p">],</span> <span class="kd">function</span><span class="p">(</span> <span class="nx">declare</span> <span class="p">)</span> <span class="p">{</span>
  </pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>This object is defining options that we will later use to create a symbol
on our map. This object contains information on the type and style (e.g., circle),
the color, and outline information to place a symbol on our map.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">_symbolOptions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;esriSMS&quot;</span><span class="p">,</span>
    <span class="s2">&quot;style&quot;</span><span class="o">:</span> <span class="s2">&quot;esriSMSCircle&quot;</span><span class="p">,</span>
    <span class="s2">&quot;color&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">134</span><span class="p">,</span><span class="mi">255</span><span class="p">],</span>
    <span class="s2">&quot;outline&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;esriSLS&quot;</span><span class="p">,</span>
      <span class="s2">&quot;style&quot;</span><span class="o">:</span> <span class="s2">&quot;esriSLSSolid&quot;</span><span class="p">,</span>
      <span class="s2">&quot;color&quot;</span><span class="o">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">159</span><span class="p">,</span><span class="mi">217</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
      <span class="s2">&quot;width&quot;</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
  <span class="p">};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>This method enables us to add a point based on the geographic
information to our map. It adds the point based on the geopgraphic
cooridnates we have passed to.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SKGeolocationAddPoint</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>To pass SKGeolocationAddPoint the proper information we need to create a point,
we must first create a <code>new esri.geometry.Point(long, lat)</code> then we can pass the
value returned to <code>esri.geometry.geographicToWebMercator()</code> finally the value that
creates gets passed to our SKGeolocationAddPoint. For an example of how this works
see SKGeolocationSuccess::constructor</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">thisPoint</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">thisSymbol</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">esri</span><span class="p">.</span><span class="nx">symbol</span><span class="p">.</span><span class="nx">SimpleMarkerSymbol</span><span class="p">(</span> <span class="nx">_symbolOptions</span> <span class="p">);</span>
    </pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>An actual graphic based on what we've told it to display via the _symbolOptions
and placed according to the information we have passed through thisPoint</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">thisGraphic</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">esri</span><span class="p">.</span><span class="nx">Graphic</span><span class="p">(</span> <span class="nx">thisPoint</span><span class="p">,</span> <span class="nx">thisSymbol</span> <span class="p">);</span>
      <span class="k">return</span> <span class="nx">map</span><span class="p">.</span><span class="nx">graphics</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span> <span class="nx">thisGraphic</span> <span class="p">);</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>This method enables us to take location information that we have previously
collected through HTML5 methods and create an ArcGIS ready Web Mercator based
geolocation so that we can add a point to our map using those coordinates.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SKGeolocationSuccess</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>The location parameter being passed is the coming from the HTML5 </p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span> <span class="nx">location</span> <span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">geolocationCurrent</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">esri</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">Point</span><span class="p">(</span><span class="nx">location</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">longitude</span><span class="p">,</span> <span class="nx">location</span><span class="p">.</span><span class="nx">coords</span><span class="p">.</span><span class="nx">latitude</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">geolocationPoint</span> <span class="o">=</span> <span class="nx">esri</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">geographicToWebMercator</span><span class="p">(</span><span class="nx">geolocationCurrent</span><span class="p">);</span>
  
      <span class="nx">SKGeolocationAddPoint</span><span class="p">(</span> <span class="nx">geolocationPoint</span> <span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Take the collected location information, pass it through the ArcGIS
geocoding system and then return a map symbol, finally center
the map on our newly created symbol and zoom in so that we can get
a close up view of where our browser thinks we are.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="k">return</span> <span class="nx">map</span><span class="p">.</span><span class="nx">centerAndZoom</span><span class="p">(</span> <span class="nx">geolocationPoint</span><span class="p">,</span> <span class="mi">16</span> <span class="p">);</span>
    <span class="p">}</span>

  <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Handles any errors that we may come up against so that our application
doesn't crash and gives useful troubleshooting information to the developer.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SKGeolocationError</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span> <span class="p">)</span> <span class="p">{</span>
       <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">clearWatch</span><span class="p">(</span><span class="nx">locationWatchIdentifier</span><span class="p">);</span>
      <span class="p">};</span>

      <span class="k">switch</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
       <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">PERMISSION_DENIED</span><span class="o">:</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[ERROR] Core.Location: A location was not provided&quot;</span><span class="p">);</span>
         <span class="k">break</span><span class="p">;</span>
       <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">POSITION_UNAVAILABLE</span><span class="o">:</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[ERROR] Core.Location: A location was not available&quot;</span><span class="p">);</span>
         <span class="k">break</span><span class="p">;</span>
       <span class="k">case</span> <span class="nx">error</span><span class="p">.</span><span class="nx">TIMEOUT</span><span class="o">:</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[ERROR] Core.Location: Timeout&quot;</span><span class="p">);</span>
         <span class="k">break</span><span class="p">;</span>
       <span class="k">default</span><span class="o">:</span>
         <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;[ERROR] Core.Location: An unknown error occured&quot;</span><span class="p">);</span>
         <span class="k">break</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>

  <span class="p">});</span>
  </pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Checks the users browser for the existence of the HTML5 Geolocation API,
based on the response it will either put a symbol on the map or it will display
useful developer error information   </p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SKGeolocationInitialize</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="nx">navigator</span><span class="p">.</span><span class="nx">geolocation</span><span class="p">.</span><span class="nx">getCurrentPosition</span><span class="p">(</span><span class="nx">SKGeolocationSuccess</span><span class="p">,</span> <span class="nx">SKGeolocationError</span><span class="p">);</span>
        </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>For the time being we have commented this out, because it adds a second
symbol to the map, right beside the original one. We are also not sure of
the necessity of the .watchPosition call. If it proves that we need it, then
we can readd this as necessary.</p>

<p>navigator.geolocation.watchPosition(SKGeolocationSuccess, SKGeolocationError);</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>

  </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Listens via Dojo for when a geoLink is click. Once it is clicked, it will fire the
initialization method that collects information from the users browser via the HTML5
Geolocation API, based on the response it will either put a symbol on the map or it
will display useful developer error information.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">SKGeolocation</span> <span class="o">=</span> <span class="nx">declare</span><span class="p">(</span><span class="s1">&#39;shackleton.geolocation&#39;</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
                    
    <span class="nx">constructor</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">geoLink</span> <span class="o">=</span> <span class="nx">dojo</span><span class="p">.</span><span class="nx">byId</span><span class="p">(</span><span class="s2">&quot;geolocationBegin&quot;</span><span class="p">);</span>
      <span class="nx">dojo</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">geoLink</span><span class="p">,</span> <span class="s1">&#39;onclick&#39;</span><span class="p">,</span> <span class="nx">SKGeolocationInitialize</span><span class="p">);</span>
    <span class="p">}</span>
        
  <span class="p">});</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">SKGeolocation</span><span class="o">:</span> <span class="nx">SKGeolocation</span>
  <span class="p">};</span>

<span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <hr />

<h4>External Documentation</h4>

<p>To learn more about the ArcGIS Javascript API methods used to
create this module we have listed the most commonly used methods
below:</p>

<ul>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#simplemarkersymbol" target=_blank">Class: SimpleMarkerSymbol</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#graphic" target=_blank">Class: Graphic</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#Map/graphics" target=_blank">Class: Map::graphics</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#geometry" target="_blank">Class: Geometry</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#point" target="_blank">Class: Point</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#namespace_geometry/esri.geometry.geographicToWebMercator" target="_blank">Class: namespace_geometry</a></li>
<li><a href="http://help.arcgis.com/en/webapi/javascript/arcgis/jsapi/#Map/centerAndZoom" target="_blank">Class: Map::centerAndZoom</a></li>
<li><a href="http://dev.w3.org/geo/api/spec-source-v2#geolocation_interface" target="_blank">W3 Development Documentation: HTML5 Geolocation API</a></li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <hr />

<h4>Task List</h4>

<ol>
<li>Read up on the necessity of the watchPosition method from the HTML5 Geolocation API
and if it is necessary or important the proper operation of the Geolocatio API, then
we should figure out a way to make this Geolocation module only display one sybmol
and not place a duplicate symbol on the map.</li>
<li>Would be helpful to have better error handling, something that not only gives
useful information to the developer, but also gives useful, on-screen information
to the person using the application. Perhaps telling them: "The map you are looking
for either wasn't found or couldn't be loaded right now. Why not check out our library
of other informative maps at http://www.fractracker.org/maps/"</li>
</ol>

<hr />

<pre><code>Shackleton is a framework for building web map applications
that are compatible with ArcGIS Online.

It is named in honor of the famous and widely respected
British Antarctic explorer Sir Ernest Henry Shackleton.

Viable Industries, ArcGIS Compatible Web Application,
where applicable. This application was built by the 
folks at Viable Industries for use by it's clients only. 
Any code herein is property of Viable Industries.
unless where otherwise noted property of Esri/ArcGIS

To find out how you can use this software or have your
own version of this software, custom built to fit your
organizations needs, contact us by visiting
www.viableindustries.com or emailing us at joshua@viable.io

Copyright (c) 2013 Viable Industries, All rights reserved.
Unless otherwise noted. 
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 